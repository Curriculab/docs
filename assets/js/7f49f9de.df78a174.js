"use strict";(globalThis.webpackChunkcurriculab_docs=globalThis.webpackChunkcurriculab_docs||[]).push([[2475],{3174(e,s,i){i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"decisions/postgresql-primary-database","title":"ADR-001: PostgreSQL as the Primary Database","description":"Decision to use PostgreSQL as the primary database for Curriculab.","source":"@site/decisions/001-postgresql-primary-database.md","sourceDirName":"decisions","slug":"/decisions/postgresql-primary-database","permalink":"/docs/decisions/postgresql-primary-database","draft":false,"unlisted":false,"editUrl":"https://github.com/Curriculab/docs/edit/main/decisions/001-postgresql-primary-database.md","tags":[],"version":"current","lastUpdatedAt":1771547468000,"sidebarPosition":1,"frontMatter":{"sidebar_label":"ADR-001: PostgreSQL","description":"Decision to use PostgreSQL as the primary database for Curriculab."},"sidebar":"decisionsSidebar","previous":{"title":"ADR Index","permalink":"/docs/decisions/"},"next":{"title":"ADR-002: UUID v4 PKs","permalink":"/docs/decisions/uuid-v4-primary-keys"}}');var n=i(4848),t=i(8453);const a={sidebar_label:"ADR-001: PostgreSQL",description:"Decision to use PostgreSQL as the primary database for Curriculab."},o="ADR-001: PostgreSQL as the Primary Database",d={},c=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Alternatives Considered",id:"alternatives-considered",level:2}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"adr-001-postgresql-as-the-primary-database",children:"ADR-001: PostgreSQL as the Primary Database"})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Date:"})," 2026-02-19\n",(0,n.jsx)(s.strong,{children:"Status:"})," Accepted"]}),"\n",(0,n.jsx)(s.h2,{id:"context",children:"Context"}),"\n",(0,n.jsx)(s.p,{children:"Curriculab requires a relational database capable of supporting a 57-entity data model with strong referential integrity, complex reporting queries, and FERPA-mandated audit guarantees. Several features of the data model drive specific database capability requirements:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Semi-structured data"})," \u2014 ",(0,n.jsx)(s.code,{children:"DegreeAuditSnapshot.audit_data"}),", ",(0,n.jsx)(s.code,{children:"ReservedSeatGroup.criteria"}),", ",(0,n.jsx)(s.code,{children:"Payment.applied_charges"}),", and ",(0,n.jsx)(s.code,{children:"AuditLog.metadata"})," hold variable-shape data that benefits from a native document type."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Array columns"})," \u2014 ",(0,n.jsx)(s.code,{children:"Room.features"}),", ",(0,n.jsx)(s.code,{children:"ApiConsumer.scopes"}),", and ",(0,n.jsx)(s.code,{children:"ScheduledReport.recipient_emails"})," are modelled as arrays to avoid unnecessary join tables for simple lists."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Network address types"})," \u2014 ",(0,n.jsx)(s.code,{children:"Session.ip_address"})," and ",(0,n.jsx)(s.code,{children:"AuditLog.ip_address"})," use a structured IP type for CIDR comparisons and indexing."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Calculated aggregates"})," \u2014 ",(0,n.jsx)(s.code,{children:"Student.cumulative_gpa"})," and ",(0,n.jsx)(s.code,{children:"Student.total_credit_hours_completed"})," are candidates for materialized views refreshed on grade-change events."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Concurrency enforcement"})," \u2014 Section enrollment capacity is enforced via a DB-level ",(0,n.jsx)(s.code,{children:"CHECK"})," constraint or trigger that fires on ",(0,n.jsx)(s.code,{children:"INSERT INTO Enrollment"})," (see ",(0,n.jsx)(s.a,{href:"/docs/decisions/optimistic-concurrency-enrollment",children:"ADR-004"}),")."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Audit immutability"})," \u2014 ",(0,n.jsx)(s.code,{children:"AuditLog"})," must be append-only; row-level security or trigger-based write guards are needed."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"All timestamps in UTC"})," \u2014 the database must store ",(0,n.jsx)(s.code,{children:"timestamptz"})," natively so UTC is preserved regardless of server locale."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"decision",children:"Decision"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"PostgreSQL (v15 or later)"})," is the primary database for all Curriculab implementation repos."]}),"\n",(0,n.jsx)(s.h2,{id:"consequences",children:"Consequences"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Positive"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"jsonb"})," with GIN indexing satisfies the semi-structured data requirements (",(0,n.jsx)(s.code,{children:"audit_data"}),", ",(0,n.jsx)(s.code,{children:"criteria"}),", ",(0,n.jsx)(s.code,{children:"parameters"}),") without a separate document store."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"text[]"})," arrays eliminate join tables for simple list attributes (",(0,n.jsx)(s.code,{children:"features"}),", ",(0,n.jsx)(s.code,{children:"scopes"}),"), keeping the schema flatter."]}),"\n",(0,n.jsxs)(s.li,{children:["The ",(0,n.jsx)(s.code,{children:"inet"})," type stores and indexes IP addresses correctly and supports CIDR containment operators."]}),"\n",(0,n.jsxs)(s.li,{children:["Materialized views (",(0,n.jsx)(s.code,{children:"REFRESH MATERIALIZED VIEW CONCURRENTLY"}),") provide an efficient GPA recalculation path without blocking reads."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"CHECK"})," constraints and ",(0,n.jsx)(s.code,{children:"AFTER INSERT"})," triggers provide database-enforced capacity and ordering rules (enrollment concurrency, waitlist position)."]}),"\n",(0,n.jsx)(s.li,{children:"Row-level security is available for multi-tenant extensions."}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"timestamptz"})," stores UTC natively; session time zone never affects stored values."]}),"\n",(0,n.jsxs)(s.li,{children:["Mature ecosystem: ",(0,n.jsx)(s.code,{children:"pg_dump"}),", logical replication, ",(0,n.jsx)(s.code,{children:"pgAdmin"}),", excellent ORM support across all target implementation languages."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Negative"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["PostgreSQL-specific features (",(0,n.jsx)(s.code,{children:"jsonb"}),", ",(0,n.jsx)(s.code,{children:"text[]"}),", ",(0,n.jsx)(s.code,{children:"inet"}),", materialized views) create a hard dependency on PostgreSQL; migrating to another RDBMS would require schema changes."]}),"\n",(0,n.jsxs)(s.li,{children:["Schema migrations are DDL changes that require careful planning and downtime or online migration tooling (e.g., ",(0,n.jsx)(s.code,{children:"pg-osc"}),", ",(0,n.jsx)(s.code,{children:"sqitch"}),")."]}),"\n",(0,n.jsx)(s.li,{children:"Horizontal write scaling requires read replicas or Citus; built-in sharding is not as seamless as distributed-native databases."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Neutral"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["All implementation repos (",(0,n.jsx)(s.code,{children:"Curriculab/api"}),", ",(0,n.jsx)(s.code,{children:"Curriculab/db"}),") must target PostgreSQL. Developers running Curriculab locally need a PostgreSQL instance (Docker Compose is the recommended local setup)."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"alternatives-considered",children:"Alternatives Considered"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"MySQL / MariaDB"}),"\nLacks native ",(0,n.jsx)(s.code,{children:"jsonb"})," (JSON column is unindexable in the same way), no built-in ",(0,n.jsx)(s.code,{children:"inet"})," type, limited materialized view support. Dropped in favour of PostgreSQL's richer type system."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"MongoDB"}),"\nA document model does not fit a highly normalized 57-entity relational schema; JOINs are not native. Weaker multi-document ACID guarantees. Would require a separate relational store for referential integrity. Rejected."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"CockroachDB"}),"\nPostgreSQL-compatible wire protocol with built-in distributed writes. Adds distributed systems complexity (clock skew, serializable isolation overhead) not warranted at this scale. Some PostgreSQL extensions are unsupported. Can be revisited if horizontal write scaling becomes a bottleneck."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"SQLite"}),"\nNot suitable for a multi-user application with concurrent writes from multiple API server instances. Rejected."]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453(e,s,i){i.d(s,{R:()=>a,x:()=>o});var r=i(6540);const n={},t=r.createContext(n);function a(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);