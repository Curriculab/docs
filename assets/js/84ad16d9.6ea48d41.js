"use strict";(globalThis.webpackChunkcurriculab_docs=globalThis.webpackChunkcurriculab_docs||[]).push([[396],{3960(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"decisions/uuid-v4-primary-keys","title":"ADR-002: UUID v4 as Primary Keys for All Entities","description":"Decision to use UUID v4 as the primary key type for all Curriculab entities.","source":"@site/decisions/002-uuid-v4-primary-keys.md","sourceDirName":"decisions","slug":"/decisions/uuid-v4-primary-keys","permalink":"/docs/decisions/uuid-v4-primary-keys","draft":false,"unlisted":false,"editUrl":"https://github.com/Curriculab/docs/edit/main/decisions/002-uuid-v4-primary-keys.md","tags":[],"version":"current","lastUpdatedAt":1771547468000,"sidebarPosition":2,"frontMatter":{"sidebar_label":"ADR-002: UUID v4 PKs","description":"Decision to use UUID v4 as the primary key type for all Curriculab entities."},"sidebar":"decisionsSidebar","previous":{"title":"ADR-001: PostgreSQL","permalink":"/docs/decisions/postgresql-primary-database"},"next":{"title":"ADR-003: User/Student Inheritance","permalink":"/docs/decisions/user-student-joined-table-inheritance"}}');var t=i(4848),r=i(8453);const a={sidebar_label:"ADR-002: UUID v4 PKs",description:"Decision to use UUID v4 as the primary key type for all Curriculab entities."},o="ADR-002: UUID v4 as Primary Keys for All Entities",l={},d=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Alternatives Considered",id:"alternatives-considered",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"adr-002-uuid-v4-as-primary-keys-for-all-entities",children:"ADR-002: UUID v4 as Primary Keys for All Entities"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Date:"})," 2026-02-19\n",(0,t.jsx)(n.strong,{children:"Status:"})," Accepted"]}),"\n",(0,t.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,t.jsx)(n.p,{children:"All 57 entities in the Curriculab data model require a primary key strategy. The choice affects:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Security"})," \u2014 sequential integer PKs expose row counts and allow enumeration attacks against REST API endpoints (e.g., ",(0,t.jsx)(n.code,{children:"GET /enrollments/1234"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API design"})," \u2014 PKs appear directly in URLs and response bodies; they must be safe to expose to all client roles including students."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Application-layer ID generation"})," \u2014 generating an ID before the ",(0,t.jsx)(n.code,{children:"INSERT"})," simplifies certain patterns (audit log references, idempotency keys, client-side optimistic UI)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Distributed compatibility"})," \u2014 even if Curriculab runs on a single PostgreSQL instance today, the schema should not assume that IDs are generated by a single sequence."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cross-entity FK chains"})," \u2014 the Student table uses a shared PK with User (see ",(0,t.jsx)(n.a,{href:"/docs/decisions/user-student-joined-table-inheritance",children:"ADR-003"}),"); UUIDs make this pattern unambiguous."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,t.jsxs)(n.p,{children:["All primary keys use ",(0,t.jsx)(n.strong,{children:"UUID version 4"})," (randomly generated, 128-bit). PostgreSQL's ",(0,t.jsx)(n.code,{children:"gen_random_uuid()"})," function (available without extensions from PG 13+) is the recommended generation method. Application-layer generation (e.g., via the ",(0,t.jsx)(n.code,{children:"uuid"})," package in Node.js or Python's ",(0,t.jsx)(n.code,{children:"uuid.uuid4()"}),") is also acceptable when an ID must be known before the INSERT."]}),"\n",(0,t.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Positive"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Non-guessable: exposure of an ID in a URL or log line does not allow enumeration of adjacent records."}),"\n",(0,t.jsx)(n.li,{children:"Globally unique without coordination: IDs can be generated in the application, a queue, or a migration script without risk of collision."}),"\n",(0,t.jsx)(n.li,{children:"No information leakage: an ID does not reveal the creation order or total row count."}),"\n",(0,t.jsxs)(n.li,{children:["Consistent: every FK across all 57 entities has the same type (",(0,t.jsx)(n.code,{children:"uuid"}),"), simplifying ORMs, query builders, and generated client SDKs."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Negative"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Storage: a UUID is 16 bytes (128 bits) vs. 4\u20138 bytes for a 32/64-bit integer PK. At scale this affects index and row sizes."}),"\n",(0,t.jsxs)(n.li,{children:["Index fragmentation: random UUID v4 values insert at random B-tree positions, causing index page splits and bloat over time. This can be mitigated with ",(0,t.jsx)(n.code,{children:"pg_repack"})," or periodic ",(0,t.jsx)(n.code,{children:"VACUUM FULL"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Readability: UUIDs are harder to reference in logs and support conversations than short integers."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Neutral"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The PostgreSQL ",(0,t.jsx)(n.code,{children:"uuid"})," column type stores values in 16 bytes (binary), not as the 36-character hyphenated string. Wire protocol and ORM mapping handle the conversion transparently."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"alternatives-considered",children:"Alternatives Considered"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Auto-incrementing integer (SERIAL / BIGSERIAL)"}),"\nSimple and storage-efficient. However, sequential IDs are enumerable through the API, which creates an IDOR (Insecure Direct Object Reference) risk unless every endpoint enforces authorization checks. Even with authorization, leaking row count via max-ID is undesirable. Rejected in favour of UUID v4."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"UUID v7 (time-ordered)"}),"\nUUID v7 embeds a millisecond-precision timestamp in the most-significant bits, making values roughly sortable and reducing B-tree fragmentation significantly compared to v4. This is the most compelling alternative. Rejected for the initial schema because PostgreSQL does not include a native ",(0,t.jsx)(n.code,{children:"gen_uuid_v7()"})," function in v15 (requires the ",(0,t.jsx)(n.code,{children:"pg_uuidv7"})," extension or application-layer generation), and UUID v7 library support across languages is less uniform than v4. This decision should be ",(0,t.jsx)(n.strong,{children:"revisited"})," as UUID v7 support matures; migrating from v4 to v7 requires only a schema and generation change, not a data-model restructure."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"ULID (Universally Unique Lexicographically Sortable Identifier)"}),"\nSortable and URL-friendly. Less standardised than UUID; adds a non-standard library dependency in every repo. Rejected in favour of the more widely supported UUID standard."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Composite natural keys"}),"\nSeveral entities have strong natural uniqueness constraints (e.g., ",(0,t.jsx)(n.code,{children:"Enrollment(student_id, section_id)"}),"). Using these as PKs reduces one level of indirection but complicates FK chains (every referencing table must carry all columns of the composite key) and API design (URLs become multi-segment). These constraints are retained as ",(0,t.jsx)(n.code,{children:"UNIQUE"})," constraints alongside a surrogate UUID PK."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>o});var s=i(6540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);